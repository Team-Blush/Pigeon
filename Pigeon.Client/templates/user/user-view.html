<!-- Title -->
<title ng-bind="title"></title>

<!-- Header -->
<div ng-include="'templates/partial/header-view.html'" ng-controller="HeaderController"></div>

<div class="container" ng-if="!isLoggedIn">
</div>

<div class="container" ng-if="isLoggedIn">
    <div class="row">
        <div class="box">
            <img class="img-wall-profile" ng-src="{{userData.profilePhotoData}}" />
            <img class="img-wall-cover" ng-src="{{userData.coverPhotoData}}" />
        </div>
    </div>
    <div class="row">
        <div class="box" ng-init="loadUserPigeons()">
            <div class="row" ng-if="userData.username == myData.username">
                <div class="col-lg-4 text-center">
                    <button type="button" class="btn btn-default" ng-click="expandCreatePigeon()">Create Pigeon</button>
                </div>
                <div class="col-lg-4 text-center">
                    <button type="button" class="btn btn-default">All Pigeons</button>
                </div>
                <div class="col-lg-4 text-center">
                    <button type="button" class="btn btn-default">Favorite Pigeons</button>
                </div>
            </div>
            <div class="row" ng-if="isCreatePigeonExpanded">
                <div class="col-lg-6 col-lg-offset-3 text-center">
                    <form role="form">
                        <div class="row">
                            <div class="form-group col-lg-12">
                                <label>Title</label>
                                <input type="text" class="form-control" ng-model="pigeonData.title">
                            </div>
                            <img class="img-preview" ng-src="{{pigeonData.photoData}}" />
                            <div class="form-group col-lg-12">
                                <label>Message</label>
                                <textarea class="form-control" rows="3" ng-model="pigeonData.content"></textarea>
                            </div>
                            <div class="form-group col-lg-12">
                                <span class="btn btn-default btn-file">
                                    Browse Photo<input id="photo-upload" type="file" ng-picture-select="onFileSelect($files)" ng-model="pigeonData.imageData">
                                </span>
                                <button type="button" class="btn btn-default" ng-click="createPigeon()">Post Pigeon</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 text-center" ng-repeat="pigeon in pigeonsData" ng-init="loadPigeonComments(pigeon)">
                    <h4>
                        {{pigeon.title}}
                    </h4>
                    <img class="img-responsive img-border img-full" ng-src="{{pigeon.photo.base64Data}}">

                    <div class="row">
                        <p>{{pigeon.content}}</p>
                        <small>{{pigeon.createdOn}}</small>
                    </div>

                    <div class="row">
                        <p>{{pigeon.favouritedCount}} Points {{pigeon.comments.length}} Comments</p>
                        <p>
                            <button type="button" class="btn btn-default btn-lg">
                                <div class="glyphicon glyphicon-star-empty"></div>
                            </button>
                            <button type="button" class="btn btn-default btn-lg">
                                <div class="glyphicon glyphicon-chevron-up"></div>
                            </button>
                            <button type="button" class="btn btn-default btn-lg">
                                <div class="glyphicon glyphicon-chevron-down"></div>
                            </button>
                            <button type="button" class="btn btn-default btn-lg" ng-click="expandComments(pigeon.id)">
                                <div class="glyphicon glyphicon-comment"></div>
                            </button>
                        </p>
                    </div>

                    <div class="row" ng-if="isCommentsExpanded && pigeon.id == expandCommentsPigeonId">
                        <form role="form">
                            <div class="row">
                                <div class="form-group col-lg-12">
                                    <label>Comment</label>
                                    <textarea class="form-control" rows="3" ng-model="commentData.content"></textarea>
                                </div>
                                <div class="form-group col-lg-12">
                                    <button type="submit" class="btn btn-default" ng-click="createComment(pigeon)">Comment</button>
                                </div>
                            </div>
                        </form>
                        <hr />
                        <div class="row" ng-repeat="comment in pigeon.comments track by $index">
                            <div class="row">
                                <div class="col-lg-4">
                                    <img class="img-small" ng-src="{{comment.author.profilePhotoData}}"/>
                                    <p>{{comment.author.username}}</p>
                                </div>
                                <div class="col-lg-4">
                                    <p>{{comment.content}}</p>
                                    <div class="row" ng-if="isEditCommentExpanded && expandEditCommentsCommentId == comment.id">
                                        <textarea type="text" rows="3" class="form-control" ng-model="editCommentData.content"></textarea>
                                        <button type="button" class="btn btn-default" ng-click="editComment(pigeon, comment)">Edit</button>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <button type="button" class="btn btn-default" ng-click="expandEditComment(comment)">Edit</button>
                                    <button type="button" class="btn btn-default" ng-click="deleteComment(pigeon, comment)">Delete</button>
                                </div>
                            </div>
                            <div class="row">
                                <hr />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<div ng-include="'templates/partial/footer-view.html'"></div>